---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");
const sortedPosts = posts
  .filter(({ data }) => !data.draft)
  .sort((a, b) =>
    new Date(b.data.modDatetime ?? b.data.pubDatetime ?? 0).getTime() -
    new Date(a.data.modDatetime ?? a.data.pubDatetime ?? 0).getTime()
  );

const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <!-- Hero (keep this section) -->
    <section id="hero" class="pt-8 pb-8">
      <div class="flex flex-col items-start gap-6 sm:[display:block]">
    <!-- Avatar (floats on ‚â•sm so text wraps) -->
    <figure
    class="mb-3 sm:mb-2 sm:float-left sm:mr-8 sm:mt-1
           sm:[shape-outside:inset(0_round_1rem)]
           sm:[clip-path:inset(0_round_1rem)]
           sm:[shape-margin:0.75rem]">
    <!-- Light -->
    <img
      src="/src/assets/images/Profile.jpg"
      alt="Portrait of Mingxuan (Adrian) Cao - Light Theme"
      width="144" height="144"
      class="h-28 w-28 rounded-2xl object-cover glow-border sm:h-80 sm:w-50 dark:hidden"
      loading="eager" decoding="async" />
    <!-- Dark -->
    <img
      src="/src/assets/images/Profile2.jpg"
      alt="Portrait of Mingxuan (Adrian) Cao - Dark Theme"
      width="144" height="144"
      class="hidden h-28 w-28 rounded-2xl object-cover glow-border sm:h-80 sm:w-50 dark:block"
      loading="eager" decoding="async" />
  </figure>
  

    <!-- Intro -->
    <div class="min-w-0">
      <!-- Name + RSS (will align to the right of the floated image on ‚â•sm) -->
      <div class="flex items-center gap-3 mb-2 sm:mb-3">
        <h1 class="text-3xl font-bold tracking-tight sm:text-4xl 
          text-black
          dark:bg-gradient-to-r dark:from-pink-500 dark:via-purple-500 dark:to-blue-500
          dark:bg-clip-text dark:text-transparent">
          Mingxuan (Adrian) Cao
        </h1>
        <a target="_blank" href="/rss.xml" class="inline-block" aria-label="RSS feed" title="RSS Feed">
          <IconRss width={20} height={20} class="scale-125 stroke-accent stroke-3 rtl:-rotate-90" />
          <span class="sr-only">RSS Feed</span>
        </a>
      </div>

      <!-- Paragraph 1 (starts aligned next to the picture) -->
      <p class="font-serif max-w-[70ch] text-lg sm:text-xl md:text-[1.35rem] leading-[1.9] text-foreground/90">
        PhD student in Data Science @ <a href="https://datascience.uchicago.edu/" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline">UChicago DSI</a>. I work at the interface of
        <span class="font-semibold">AI & statistics</span>‚Äîfocusing on diffusion/SDE models,
        inference-time guidance, and reinforcement learning for purposeful generation.
        Current applications center on protein/molecular design, virtual cells simulation,
        and interpretable AI-for-Biology in general.
      </p>

      <!-- Paragraph 2 (continues wrapping around the picture) -->
      <p class="mt-3 sm:clear-left font-serif max-w-[70ch] text-lg sm:text-xl md:text-[1.35rem] leading-[1.9] text-foreground/90">        Before UChicago, I completed my undergraduate and master's degrees in 4 years with highest distinction at
        <a href="https://sds.wustl.edu/" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline">WashU</a>. Go Bears! üêª
      </p>

      <!-- Stop wrapping so Socials don‚Äôt sit beside the image -->
      <div class="clear-left sm:mt-2"></div>

      <div class="mt-4 flex flex-wrap items-center gap-3 sm:clear-left">
        {SOCIALS.length > 0 && (
          <div class="ms-2 inline-flex items-center gap-2">
            <span class="text-sm opacity-80">Social:</span>
            <Socials />
          </div>
        )}
      </div>
    </div>
</section>

    <Hr />

    <!-- News (combines previous Featured + Recent blocks) -->
    <section id="news" class="pt-12 pb-6">
      <h2 class="text-2xl font-semibold tracking-wide">News</h2>
       <ul class="font-serif list-disc list-inside mt-2 text-lg sm:text-xl md:text-[1.35rem] leading-[1.9]">
              <li>Adrian‚Äôs site is available now! üéâ</li>
      </ul>
    </section>

    <div class="my-8 text-center">
      <LinkButton href="/posts/">
        Blog Archive
      </LinkButton>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>